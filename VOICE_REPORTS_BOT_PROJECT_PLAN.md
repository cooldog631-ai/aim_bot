# План проекта: AI-бот для автоматизации голосовых отчетов

## 1. Обзор проекта

### Цель
Создание автоматизированной системы сбора и обработки голосовых отчетов от сотрудников с использованием AI для транскрибации, валидации и структурирования данных.

### Проблема
- Сотрудники не заполняют отчеты или заполняют некачественно
- Отсутствие контроля за регулярностью отчетности
- Неудобство заполнения текстовых форм в конце смены
- Сложность анализа неструктурированных данных

### Решение
Голосовой бот, который принимает отчеты в формате аудиосообщений, автоматически транскрибирует, валидирует полноту данных, запрашивает недостающую информацию и сохраняет в структурированном виде в БД.

---

## 2. Техническая архитектура

### 2.1 Компоненты системы

```
[Пользователь]
    ↓ (голосовое сообщение)
[Мессенджер: Telegram/VK Max]
    ↓ (API)
[Сервер приложения]
    ↓
[Модуль транскрибации: Whisper]
    ↓
[AI-анализатор: Claude/GPT/Локальная модель]
    ↓
[SQL База данных]
    ↓
[Dashboard: DataLens/Собственный фронт]
```

### 2.2 Технологический стек

**Мессенджер платформа:**
- Вариант 1: Telegram Bot API (проще, быстрее)
- Вариант 2: VK Max API (более "православно" для корпоративного сектора)
- Вариант 3: Собственный веб-интерфейс с кнопкой записи

**Серверная часть:**
- Railway/собственный сервер
- Python/Node.js для бэкенда
- Регулярные проверки новых сообщений (polling каждые 5-10 секунд)

**Транскрибация:**
- Вариант 1: OpenAI Whisper API (быстро, но внешний сервис)
- Вариант 2: Локальный Whisper через Ollama (безопаснее, медленнее)

**AI-обработка:**
- Вариант 1: Claude/GPT API (быстро, для MVP)
- Вариант 2: Локальная модель через LM Studio/Ollama (для продакшена)

**База данных:**
- PostgreSQL/SQLite
- Хостинг на том же сервере, что и приложение

**Визуализация:**
- Вариант 1: Yandex DataLens (готовое решение)
- Вариант 2: Собственный фронт (более гибко, можно собрать с помощью Claude Code)

---

## 3. Структура базы данных

### 3.1 Таблица: employees
```sql
CREATE TABLE employees (
    id INTEGER PRIMARY KEY,
    full_name TEXT NOT NULL,
    messenger_nickname TEXT UNIQUE,
    department_id INTEGER,
    created_at TIMESTAMP,
    FOREIGN KEY (department_id) REFERENCES departments(id)
);
```

### 3.2 Таблица: departments
```sql
CREATE TABLE departments (
    id INTEGER PRIMARY KEY,
    name TEXT NOT NULL,
    description TEXT
);
```

### 3.3 Таблица: permissions
```sql
CREATE TABLE permissions (
    id INTEGER PRIMARY KEY,
    employee_id INTEGER,
    can_submit_reports BOOLEAN DEFAULT TRUE,
    can_request_reports BOOLEAN DEFAULT FALSE,
    can_edit_reports BOOLEAN DEFAULT FALSE,
    can_export_data BOOLEAN DEFAULT FALSE,
    FOREIGN KEY (employee_id) REFERENCES employees(id)
);
```

### 3.4 Таблица: reports
```sql
CREATE TABLE reports (
    id INTEGER PRIMARY KEY,
    employee_id INTEGER,
    report_date DATE NOT NULL,
    equipment_number TEXT,
    brigade_number TEXT,
    transcription TEXT,
    structured_data JSON,
    status TEXT, -- 'pending', 'validated', 'confirmed'
    created_at TIMESTAMP,
    confirmed_at TIMESTAMP,
    FOREIGN KEY (employee_id) REFERENCES employees(id)
);
```

### 3.5 Таблица: report_sessions
```sql
CREATE TABLE report_sessions (
    id INTEGER PRIMARY KEY,
    employee_id INTEGER,
    status TEXT, -- 'active', 'waiting_confirmation', 'closed'
    messages JSON, -- история сообщений в сессии
    created_at TIMESTAMP,
    closed_at TIMESTAMP,
    FOREIGN KEY (employee_id) REFERENCES employees(id)
);
```

---

## 4. Бизнес-логика и процессы

### 4.1 Основной рабочий процесс

1. **Получение голосового сообщения**
   - Сотрудник отправляет голосовое сообщение в бот
   - Сервер проверяет аутентификацию (есть ли пользователь в БД)
   - Проверяет права доступа (может ли отправлять отчеты)

2. **Транскрибация**
   - Аудио передается в Whisper
   - Получается текстовая расшифровка

3. **AI-анализ**
   - Проверка на полноту данных (согласно промпту с референсным шаблоном)
   - Обязательные поля: дата, номер техники, бригада, описание работ
   - Извлечение структурированных данных

4. **Валидация**
   - Если данные неполные → генерация уточняющих вопросов
   - Бот отправляет запрос пользователю
   - Ожидание ответа (создается активная сессия)

5. **Подтверждение**
   - AI формирует структурированный отчет
   - Отправляет пользователю для проверки с кнопками:
     - ✅ "Подтвердить"
     - ✏️ "Исправить"
   - При подтверждении - сохранение в БД
   - При запросе на исправление - повторный цикл

6. **Сохранение**
   - Данные сохраняются в таблицу reports
   - Сессия закрывается
   - Пользователь получает подтверждение

### 4.2 Дополнительные процессы

**Напоминания:**
- Cron-задача в 18:00 проверяет, кто не сдал отчет
- Отправка напоминания в мессенджер

**Запрос отчетов (для руководителей):**
- Команда `/report <период>` или `/my_reports`
- Генерация и отправка отчета

**Корректировка отчетов:**
- Пользователь может запросить изменение последнего отчета
- AI находит отчет, вносит изменения, сохраняет с версионированием

**Экспорт данных:**
- Команда `/export <формат> <период>`
- Генерация файла Excel/CSV

---

## 5. Безопасность и приватность

### 5.1 Аутентификация
- Whitelist разрешенных messenger ID
- Проверка при каждом запросе

### 5.2 Авторизация (RBAC - Role-Based Access Control)
- Роли: сотрудник, инструктор, руководитель, администратор
- Права доступа через таблицу permissions

### 5.3 Защита персональных данных
- Вариант 1: Локальная обработка (Whisper + локальная LLM)
- Вариант 2: Предобработка перед отправкой в облако:
  - ФИО → ID сотрудника
  - Удаление персональных данных из контекста

### 5.4 Аудит
- Логирование всех операций
- История изменений отчетов

---

## 6. Пользовательский интерфейс

### 6.1 Интерфейс бота (команды)
```
/start - Начало работы, регистрация
/report - Отправить отчет (с последующим голосовым сообщением)
/my_reports - Мои отчеты за период
/edit_last - Исправить последний отчет
/help - Справка по командам
```

### 6.2 Dashboard (веб-интерфейс)

**Для сотрудников:**
- История своих отчетов
- Статистика по периодам
- Календарь с отметками о сданных отчетах

**Для руководителей:**
- Сводка по всем сотрудникам
- Графики и аналитика
- Кто не сдал отчеты
- Экспорт данных

**Для администраторов:**
- Управление пользователями
- Настройка прав доступа
- Настройка шаблонов отчетов
- Логи системы

---

## 7. Промпты для AI

### 7.1 Промпт для валидации отчета
```
Ты - ассистент для обработки отчетов сотрудников.

ОБЯЗАТЕЛЬНЫЕ ПОЛЯ В ОТЧЕТЕ:
- Дата (формат: ДД.ММ.ГГГГ)
- Номер техники/комбайна
- Номер бригады
- Описание выполненных работ

ТВОЯ ЗАДАЧА:
1. Проанализировать транскрипцию голосового отчета
2. Извлечь все обязательные поля
3. Если какие-то поля отсутствуют - сформировать список недостающих данных
4. Вернуть результат в JSON формате:
{
  "complete": true/false,
  "missing_fields": ["поле1", "поле2"],
  "extracted_data": {
    "date": "...",
    "equipment_number": "...",
    "brigade_number": "...",
    "work_description": "..."
  }
}

ТРАНСКРИПЦИЯ:
{transcription}
```

### 7.2 Промпт для генерации уточняющих вопросов
```
На основе списка недостающих полей сгенерируй вежливое сообщение сотруднику
с просьбой уточнить информацию. Сообщение должно быть на русском языке,
дружелюбным и конкретным.

Недостающие поля: {missing_fields}

Пример: "Спасибо за отчет! Для завершения мне нужна еще пара деталей:
- На какой дате вы работали?
- Какой номер техники использовали?"
```

### 7.3 Промпт для форматирования подтверждения
```
Сформируй структурированный отчет для подтверждения сотрудником.
Представь данные в читаемом формате с эмодзи для лучшего восприятия.

Данные: {structured_data}

Пример формата:
📅 Дата: 25.10.2025
🚜 Техника: Комбайн №15
👷 Бригада: №3
📝 Выполненные работы:
- Проверка топливной системы
- Инструктаж бригады по технике безопасности
- Осмотр гидравлики

Все верно? Подтвердите или запросите исправления.
```

---

## 8. План разработки (MVP)

### 8.1 Этап 1: Прототип (1 неделя)
**Цель:** Доказательство концепции

- [ ] Настройка Telegram бота (базовая)
- [ ] Получение и сохранение аудио
- [ ] Интеграция с OpenAI Whisper API
- [ ] Простая транскрибация без AI-анализа
- [ ] Сохранение в SQLite
- [ ] Простой вывод данных в консоль

**Критерий успеха:** Бот получает голосовое, транскрибирует и сохраняет

### 8.2 Этап 2: AI-обработка (1 неделя)
**Цель:** Добавление интеллектуального анализа

- [ ] Интеграция с Claude/GPT API
- [ ] Промпты для валидации
- [ ] Логика проверки полноты данных
- [ ] Генерация уточняющих вопросов
- [ ] Система сессий (многоэтапный диалог)

**Критерий успеха:** Бот умеет задавать уточняющие вопросы

### 8.3 Этап 3: База данных (3-4 дня)
**Цель:** Структурированное хранение

- [ ] Проектирование схемы БД
- [ ] Создание таблиц
- [ ] CRUD операции
- [ ] Система аутентификации
- [ ] Права доступа (базовые)

**Критерий успеха:** Данные корректно сохраняются и извлекаются

### 8.4 Этап 4: Визуализация (3-4 дня)
**Цель:** Dashboard для просмотра отчетов

Вариант A: Yandex DataLens
- [ ] Подключение к БД
- [ ] Создание чартов
- [ ] Сборка дашборда

Вариант B: Собственный фронт
- [ ] Простой веб-интерфейс (React/Next.js)
- [ ] API для получения данных
- [ ] Базовая визуализация

**Критерий успеха:** Можно видеть отчеты в удобном формате

### 8.5 Этап 5: Полировка (3-4 дня)
**Цель:** Production-ready версия

- [ ] Обработка ошибок
- [ ] Защита от дурака
- [ ] Улучшение UX
- [ ] Напоминания (cron-задачи)
- [ ] Экспорт данных
- [ ] Документация

**Критерий успеха:** Система стабильно работает, удобна для пользователей

---

## 9. Тестирование локальной модели

### Задачи для тестирования LM Studio
- [ ] Установить LM Studio
- [ ] Загрузить модель (рекомендуется Llama 3.1 8B или Mistral 7B)
- [ ] Протестировать скорость ответа
- [ ] Протестировать качество:
  - Валидация отчетов
  - Извлечение структурированных данных
  - Генерация вопросов на русском языке
- [ ] Измерить использование ресурсов (CPU/RAM/GPU)
- [ ] Сравнить с результатами Claude/GPT

### Критерии оценки:
- Время ответа < 10 секунд (приемлемо)
- Точность извлечения данных > 90%
- Качество генерации текста на русском языке

---

## 10. Коммерческая ценность и презентация

### 10.1 Расчет ROI

**Текущие затраты (без системы):**
- Время на заполнение отчета вручную: 10-15 минут
- Количество сотрудников: N
- Рабочих дней в месяц: 22
- **Итого времени в месяц:** N × 15 мин × 22 дня = **N × 5.5 часов**
- При средней зарплате 50 000₽/мес (≈220₽/час): **N × 1 210₽/месяц**
- **За год:** **N × 14 520₽**

**Дополнительные проблемы (оценка):**
- Несвоевременная сдача отчетов: потеря контроля
- Некачественные отчеты: сложность анализа
- Инциденты из-за отсутствия контроля: риски безопасности

**Экономия с системой:**
- Время на голосовой отчет: 2-3 минуты
- Экономия времени: 80%
- **Экономия в деньгах:** N × 11 616₽/год
- Улучшение качества и регулярности отчетов: **бесценно**

**Стоимость решения:**
- Разработка: $5,000 - $10,000 (разовая)
- Поддержка: минимальная (если локальная модель)
- API затраты: ~$100-200/год (если облачная AI)

**Срок окупаемости:**
- При N=10 сотрудников: экономия 116 160₽/год ≈ $1,300/год
- Окупаемость: 4-8 лет (консервативно)
- **НО:** с учетом улучшения качества, безопасности, контроля - **1-2 года**

### 10.2 Ключевые аргументы для презентации

**Проблемы, которые решает система:**
1. ❌ Сотрудники не заполняют отчеты → ✅ Говорить удобнее, чем писать
2. ❌ Низкое качество отчетов → ✅ AI проверяет полноту данных
3. ❌ Нет контроля за регулярностью → ✅ Автоматические напоминания
4. ❌ Сложно анализировать данные → ✅ Структурированная БД + дашборд
5. ❌ Риски безопасности → ✅ Полная история действий сотрудников

**Уникальные преимущества:**
- 🎤 **Голосовой ввод:** в 5 раз быстрее набора текста
- 🤖 **AI-валидация:** автоматическая проверка полноты
- 🔒 **Безопасность:** локальная обработка (опционально)
- 📊 **Аналитика:** мгновенный доступ к данным
- 💰 **ROI:** окупаемость 1-2 года

**Масштабируемость:**
- Начать с одного отдела (pilot)
- Расширить на всю компанию
- Добавить другие типы отчетов
- Интегрировать с CRM/ERP системами

---

## 11. Следующие шаги

### Немедленные действия:
1. ✅ Проанализировать транскрипцию звонка
2. 📝 Составить план проекта (текущий документ)
3. 🧪 Протестировать LM Studio с локальной моделью
4. 🔌 Подключить MCP сервера для Telegram
5. 💼 Подготовить презентацию для руководства с ROI

### На следующей встрече с коучем:
- Подключение MCP для Telegram
- Начало разработки прототипа
- Обсуждение результатов теста локальной модели
- Доработка промптов

### Для презентации руководству:
- Подготовить ROI расчеты с реальными цифрами компании
- Создать визуальный макет (можно в Figma или простой HTML)
- Подготовить демо на базе прототипа
- Оформить через стороннее ИП для подстраховки юридических рисков

---

## 12. Риски и митигация

| Риск | Вероятность | Влияние | Митигация |
|------|-------------|---------|-----------|
| Локальная модель работает медленно | Высокая | Среднее | Начать с облачного API, потом мигрировать |
| Качество транскрибации низкое | Средняя | Высокое | Использовать Whisper large модель, тестировать |
| Возражения по безопасности | Средняя | Высокое | Предлагать локальное решение |
| Интеграция с Max API сложная | Средняя | Среднее | Начать с Telegram, переключиться потом |
| Пользователи не примут решение | Низкая | Высокое | Пилот с 5-10 пользователями, собрать feedback |
| Недостаточный ROI | Низкая | Высокое | Добавить косвенные выгоды (безопасность, контроль) |

---

## 13. Дальнейшее развитие (Roadmap)

### Версия 2.0 (через 3-6 месяцев)
- Интеграция с другими мессенджерами
- Мобильное приложение
- Голосовой ввод прямо на сайте
- Расширенная аналитика и ML-предсказания

### Версия 3.0 (через 6-12 месяцев)
- Агентская система на базе Claude Code
- Автоматическое изменение регламентов
- Интеграция с CRM/ERP
- Мультиязычность

### Экосистема (долгосрочно)
- Универсальный AI-ассистент для всех процессов компании
- Автоматизация workflow
- Предиктивная аналитика
- Автономное управление операционными процессами

---

## 14. Контакты и ресурсы

### Полезные ссылки:
- Telegram Bot API: https://core.telegram.org/bots/api
- OpenAI Whisper: https://openai.com/research/whisper
- LM Studio: https://lmstudio.ai/
- Yandex DataLens: https://datalens.yandex.ru/
- Claude Code: https://docs.claude.com/claude-code

### Следующая встреча:
- Дата: Суббота (перед командировкой)
- Цель:
  - Подключение MCP Telegram
  - Начало разработки MVP
  - Обсуждение тестирования локальной модели

---

**Статус проекта:** 📋 Планирование
**Ожидаемый срок MVP:** 2-3 недели
**Бюджет:** $5,000 - $10,000
**ROI:** 1-2 года

---

*Документ создан на основе транскрипции коуч-сессии по AI*
*Версия: 1.0*
*Дата: 30 октября 2025*
